import matplotlib.pyplot as plt
import numpy as np

"""
The standard mineiro function is the only viable fast option
for accuracy, although the speed improvements are only minor.
If accuracy at high frequencies isn't nececarry, then the
powx_ekmett_fast_lb function is a great choice.

The following table compares the speed and error margin of
different exp2 approxiamtions used in the following formula:
    440 * exp2((midi - 69) / 12)
    440 * pow(2, (midi - 69) / 12)

SEC      xSPEED ERROR  NAME
0.055390               pass
0.080395 1      0      exp2
0.191968 0.18   0      exp_stl
0.090972 0.7    1200   powx_ekmett_fast_precise
0.090459 0.71   bad    powx_ekmett_fast_better_precise
0.083222 0.8    1200   desoras
0.082704 0.91   0.1    exp_mineiro
0.080687 0.98   0      powx_stl
0.078116 1.1    0.005  mineiro           -- amazing at all ranges
0.066564 2.23   400    exp_mineiro_faster
0.065485 2.47   1200   exp_ekmett_ub
0.065346 2.51   400    exp_schraudolph
0.063016 3.27   bad    powx_ekmett_fast_ub
0.062933 3.31   bad    powx_ekmett_fast
0.062901 3.32   67     powx_ekmett_fast_lb -- amazing at low and high ranges. worst at 2khz
0.062945 3.3    400    schraudolph
0.062359 3.58   400    mineiro_faster

- pass = no processing
- stl = exp2
- xSpeed of the exp2 function calculated: (exp2 - pass) / (other_sec - pass)
- Error is in Hz
"""

class Styles:
    idx = 0
    types = ['solid', 'dotted', 'dashed', 'dashdot']

    def get(self):
        s = self.types[self.idx]
        self.idx = (self.idx + 1) & 3
        return s

linestyles = Styles()

fig, ax = plt.subplots()

x_labels = [
    -36.3, # 1Hz
    -24.3, # 2Hz
    -8.5, # 5Hz
    3.4, # 10Hz
    15.4, # 20Hz
    31.3, # 50Hz
    43.3, # 100Hz
    55.3, # 200Hz
    71.2, # 500Hz
    83.2, # 1kHz
    95.2, # 2kHz
    111, # 5kHz
    123, # 10kHz
    135, # 20kHz
]
x_ticks = [i for i in range(len(x_labels))]

plt.xlabel('Midi')
plt.xticks(ticks=x_ticks, labels=x_labels)
plt.ylabel('Hz')

exp2 = [1.000024437904,2.000043869019,5.000087261200,10.000148773193,20.000244140625,50.000442504883,100.000602722168,200.000656127930,499.999786376953,999.996826171875,1999.988281250000,4999.952148437500,9999.875976562500,19999.699218750000,]
mineiro = [0.999985933304,1.999958753586,5.000100135803,10.000147819519,20.000400543213,49.998588562012,99.996337890625,199.992675781250,499.974975585938,999.949951171875,1999.873046875000,4999.951171875000,9999.902343750000,19999.804687500000,]
mineiro_faster = [0.998051762581,1.996103525162,5.098814964294,10.197577476501,20.395154953003,49.643173217773,99.285926818848,198.571853637695,495.933227539062,991.866455078125,1983.706054687500,5100.605468750000,10201.210937500000,20402.207031250000,]
schraudolph = [0.997468233109,1.994936466217,5.096480846405,10.192909240723,20.385818481445,49.624500274658,99.248580932617,198.497161865234,495.634460449219,991.262207031250,1982.524414062500,5098.188476562500,10196.376953125000,20392.753906250000,]
desoras = [1.047299385071,2.094592094421,5.295790672302,10.591554641724,21.183057785034,51.219005584717,102.437782287598,204.875137329102,521.146545410156,1042.289550781250,2084.572265625000,5302.312500000000,10604.596679687500,21209.140625000000,]
powx_stl = [1.000024437904,2.000043869019,5.000087261200,10.000148773193,20.000244140625,50.000442504883,100.000602722168,200.000656127930,499.999786376953,999.996826171875,1999.988281250000,4999.952148437500,9999.875976562500,19999.699218750000,]
powx_ekmett_fast = [0.709634125233,1.469091176987,3.808965682983,8.016567230225,16.830301284790,44.621410369873,92.431907653809,191.241989135742,500.337524414062,1051.700439453125,2205.451660156250,5813.886718750000,12035.976562500000,24888.144531250000,]
powx_ekmett_fast_lb = [0.973327159882,1.946654319763,4.999916553497,9.999780654907,19.999561309814,48.851985931396,97.703552246094,195.407104492188,483.274230957031,966.541748046875,1933.083496093750,4999.306640625000,9998.613281250000,19997.226562500000,]
powx_ekmett_fast_ub = [0.628569424152,1.331102848053,3.411077260971,7.361021041870,15.905466079712,43.792667388916,92.319030761719,194.105453491211,528.129577636719,1131.998291015625,2415.488281250000,6364.638671875000,13335.136718750000,27882.207031250000,]
powx_ekmett_fast_precise = [0.964870989323,1.929741978645,4.710827350616,9.421605110168,18.843210220337,48.352100372314,96.703552246094,193.407104492188,521.147155761719,1042.287597656250,2084.575195312500,5302.316894531250,10604.580078125000,21209.160156250000,]
powx_ekmett_fast_better_precise = [0.786764979362,1.573529958725,4.347806930542,8.695521354675,17.391042709351,48.672695159912,97.345390319824,194.690780639648,522.970275878906,1045.940551757812,2091.857666015625,5836.724121093750,11673.324218750000,23346.648437500000,]
exp_stl = [1.000024676323,2.000043630600,5.000087738037,10.000149726868,20.000242233276,50.000442504883,100.000602722168,200.000656127930,499.999786376953,999.996826171875,1999.988281250000,4999.952636718750,9999.875976562500,19999.701171875000,]
exp_ekmett_ub = [1.047297716141,2.094595432281,5.295798778534,10.591545104980,21.183090209961,51.219043731689,102.437667846680,204.875335693359,521.147155761719,1042.287597656250,2084.575195312500,5302.290039062500,10604.580078125000,21209.160156250000,]
exp_schraudolph = [0.997468233109,1.994936466217,5.096480846405,10.192909240723,20.385818481445,49.624500274658,99.248580932617,198.497161865234,495.634460449219,991.262207031250,1982.524414062500,5098.188476562500,10196.376953125000,20392.753906250000,]
exp_mineiro = [0.999985933304,1.999958753586,5.000100135803,10.000147819519,20.000400543213,49.998588562012,99.996337890625,199.992675781250,499.974975585938,999.949951171875,1999.873046875000,4999.951171875000,9999.902343750000,19999.804687500000,]
exp_mineiro_faster = [0.998051762581,1.996103525162,5.098814964294,10.197577476501,20.395154953003,49.643173217773,99.285926818848,198.571853637695,495.933227539062,991.866455078125,1983.706054687500,5100.605468750000,10201.210937500000,20402.207031250000,]

x = [i for i in range(len(exp2))]


ax.plot(exp2, label='exp2', linestyle=linestyles.get())
ax.plot(mineiro, label='mineiro', linestyle=linestyles.get())
ax.plot(mineiro_faster, label='mineiro_faster', linestyle=linestyles.get())
ax.plot(schraudolph, label='schraudolph', linestyle=linestyles.get())
ax.plot(desoras, label='desoras', linestyle=linestyles.get())
ax.plot(powx_stl, label='powx_stl', linestyle=linestyles.get())
ax.plot(powx_ekmett_fast, label='powx_ekmett_fast', linestyle=linestyles.get())
ax.plot(powx_ekmett_fast_lb, label='powx_ekmett_fast_lb', linestyle=linestyles.get())
ax.plot(powx_ekmett_fast_ub, label='powx_ekmett_fast_ub', linestyle=linestyles.get())
ax.plot(powx_ekmett_fast_precise, label='powx_ekmett_fast_precise', linestyle=linestyles.get())
ax.plot(powx_ekmett_fast_better_precise, label='powx_ekmett_fast_better_precise', linestyle=linestyles.get())
ax.plot(exp_stl, label='exp_stl', linestyle=linestyles.get())
ax.plot(exp_ekmett_ub, label='exp_ekmett_ub', linestyle=linestyles.get())
ax.plot(exp_schraudolph, label='exp_schraudolph', linestyle=linestyles.get())
ax.plot(exp_mineiro, label='exp_mineiro', linestyle=linestyles.get())
ax.plot(exp_mineiro_faster, label='exp_mineiro_faster', linestyle=linestyles.get())

ax.legend()
plt.show()
